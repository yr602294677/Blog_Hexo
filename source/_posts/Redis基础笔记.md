---
title: Redis
date: 2019-11-29 23:47:44 
categories: "JAVA" 
tags: JAVA
description: git操作命令记录


---



## Redis（基于内存的key-value数据库）

###  一.  特点

1. Redis支持数据的持久化，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。
2. Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。
3. Redis支持数据的备份，即master-slave模式的数据备份。
4. 丰富的特性 – Redis还支持 publish/subscribe, 通知, key 过期等等特性。
5. 效率高。纯内存工作，每秒可处理十万次读写操作，是已知最快的。
6. 可存放多种数据结构。每个value最大为1G。
7. **单线程模式处理请求。** 
   * 非阻塞异步事件处理机制
   * 避免线程上下文切换的代价。（因为内存IO操作时间不会太长。）
8. 

### 二. 数据类型

1. string
   * 内部通过SDS（simple dynamic string 简单动态字符串）存储，类似java中的ArrayList。通过预分配冗余空间的方式来减少内存的频繁分配
   * 应用场景
     * 缓存功能
     * 实时计数器，可实现快速计数和查询。最终结果可以落地到数据库中。
     * 共享用户session。不用每次刷新页面后访问数据或页面缓存cookie来做重新登录。
   
2. list 
   * 应用场景
     * 消息队列。生产者插入数据通过Lpush类似左进右出。消费者通过BRpop阻塞地抢列尾的数据。
     * 通过irange命令实现分页查询。
     * 博客的文章列表做分页展示。
   
3. hash 
   
   * 类似java对象，一般用于可以结构化的数据储存在redis中。
   
4. set 无序集合，自动去重
   * 应用场景
     * 多台服务器的数据做全局去重。
     * 基于set做交集、并集、差集。如查看两个用户的好友列表中的共同好友。
   
5. sorted set（带有score的排序set）
   * 应用场景
     * 排行榜。根据发布时间、点赞数等排序。
     * 带权重消息队列。如普通消息score为1，重要消息为2。工作线程通过score的倒序来获取获取工作任务，优先执行重要任务。
   
6. HyperLogLog （统计基数）

   * 只计数，不储存元素本身。
   *  提供不精确的去重计数功能 

7. pub/sub 

   * 可以用作简单的消息队列。 

8. #### Geospatial:

   * 可以用来保存地理位置，并作位置距离计算或者根据半径计算位置等。有没有想过用Redis来实现附近的人？或者计算最优地图路径？

9.  pipeline 

   * 可以批量执行一组指令，一次性返回全部结果，可以减少频繁的请求应答。 

10. Redis Module   https://redis.io/modules 

### 三  数据持久化

1. RDB（数据快照，适合冷备份）

   *  对 Redis中的数据执行**周期性**的持久化 
   * 优点
     *  生成多个数据文件，每个数据文件分别都代表了某一时刻Redis里面的数据 。可以 设置定时任务，定时同步到远端的服务器，方便恢复数据
     * 同步时fork一个子进程做持久化，对redis性能影响小，恢复数据时比AOF快。
   * 缺点
     * 默认五分钟或者更久生成一次，会丢失数据。
     * 若快照文件很大，可能会导致客户端延迟。若正好在做秒杀等活动，问题较大。

2. AOF（适合热备）

   *  对每条写入命令作为日志，以 **append-only** 的模式写入一个日志文件中，因为这个模式是只追加的方式，所以没有任何磁盘寻址的开销，所以很快，有点像Mysql中的**binlog**。 
   * 两种持久化方式同时存在时，默认使用AOF，因为数据更完整。
   * 优点
     * 数据完整性高，最多丢失一秒数据。
     *  AOF在对日志文件进行操作的时候是以追加的方式写数据，少了很多磁盘寻址的开销，文件也不易破损。
     *  适合做**灾难性数据误删除**的紧急恢复了

   > AOF 文件的生成过程具体包括命令追加，文件写入，文件同步三个步骤。Redis 在执行完一个写命令后，都会将执行的写命令追回到 Redis 内部的缓冲区的末尾。这个过程是命令的**追加**过程。接下来，缓冲区的写命令会被写入到 AOF 文件，这一过程是文件**写入**过程。对于操作系统来说，调用write函数并**不会立刻**将数据写入到硬盘，为了将数据真正写入硬盘，还需要调用fsync函数，调用fsync函数即是文件同步的过程。只有经过文件同步过程，AOF 文件才在硬盘中真正保存了 Redis 的写命令。假如公司的实习生通过**flushall**清空了所有的数据，只要这个时候后台重写还没发生，你马上拷贝一份**AOF**日志文件，把最后一条**flushall**命令删了就完事了。

   * 缺点
     * 文件较大。
     *  每秒都要去异步刷新一次日志 ，开启后效率低。

3. 如何选择

   ​	都用， 第一时间用**RDB**恢复，然后**AOF**做数据补全 。

### 四  内存淘汰机制































> 参考资料：
>
> 吊打面试官之redis  https://my.oschina.net/javaFamily 